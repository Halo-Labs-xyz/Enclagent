import{r as m,j as E}from"./launchpad.js";import{dy as D,d4 as I,d5 as M,d6 as N,dn as x,du as f,ew as v,dp as O,d9 as d,dH as U}from"./launchpad-App-CJN8YHj9.js";import{a as j}from"./launchpad-shouldProceedtoEmbeddedWalletCreationFlow-BsPl2jCD-4dyd-DVQ.js";import{n as k}from"./launchpad-ScreenLayout-Ca6ml9wY-tWBwodfe.js";import{c as $}from"./launchpad-telegram-B-JqnkqZ-B2ok6_jI.js";import"./launchpad-ModalHeader-JjfRejxC-CtYe7KE2.js";import"./launchpad-Screen-DE3ldE_X-Bg_Q5Z_h.js";import"./launchpad-index-Dq_xe9dz-DPq0PTtR.js";const F=({success:r,errorMessage:a,onRetry:c})=>{let i=r?"Successfully connected with Telegram":a?a.message:"Verifying connection to Telegram";return E.jsx(k,{title:i,subtitle:r?"You're good to go!":a?a.detail:"Just a few moments more",icon:$,iconVariant:"loading",iconLoadingStatus:{success:r,fail:!!a},secondaryCta:a?.retryable&&c?{label:"Retry",onClick:c}:void 0,watermark:!0})},Y={component:()=>{let{authenticated:r,logout:a,ready:c,user:i}=D(),{setModalData:y,navigate:l,resetNavigation:u,data:p}=I(),A=M(),{initLoginWithTelegram:R,loginWithTelegram:b,updateWallets:C,setReadyToTrue:w,closePrivyModal:_,createAnalyticsEvent:W,getAuthMeta:h}=N(),[g,L]=m.useState(!1),[S,o]=m.useState(void 0),s=x();async function T(){try{let e=await async function(){let t;if(!r){if(s.enabled&&s.status==="error")throw new O(s.error,null,d.CAPTCHA_FAILURE);return s.enabled&&s.status!=="success"&&(s.execute(),t=await s.waitForResult()),t}}();await b({captchaToken:e}),L(!0),w(!0)}catch(e){if(e?.privyErrorCode===d.ALLOWLIST_REJECTED)return o(void 0),u(),void l("AllowlistRejectionScreen");if(e?.privyErrorCode===d.USER_LIMIT_REACHED)return console.error(new U(e).toString()),o(void 0),u(),void l("UserLimitReachedScreen");if(e?.privyErrorCode===d.USER_DOES_NOT_EXIST)return o(void 0),u(),void l("AccountNotFoundScreen");if(e?.privyErrorCode===d.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return o(void 0),u(),y({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,telegramAuthResult:h()?.telegramAuthResult,telegramWebAppData:h()?.telegramWebAppData,displayName:e.data?.data?.account?.displayName,linkMethod:"telegram",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void l("LinkConflictScreen");let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}return m.useEffect(()=>{T()},[]),m.useEffect(()=>{if(!(c&&r&&g&&i))return;if(A?.legal.requireUsersAcceptTerms&&!i.hasAcceptedTerms){let t=setTimeout(()=>{l("AffirmativeConsentScreen")},f);return()=>clearTimeout(t)}if(j(i,A.embeddedWallets)){let t=setTimeout(()=>{y({createWallet:{onSuccess:()=>{},onFailure:n=>{console.error(n),W({eventName:"embedded_wallet_creation_failure_logout",payload:{error:n,provider:"telegram",screen:"TelegramAuthScreen"}}),a()},callAuthOnSuccessOnClose:!0}}),l("EmbeddedWalletOnAccountCreateScreen")},f);return()=>clearTimeout(t)}C();let e=setTimeout(()=>_({shouldCallAuthOnSuccess:!0,isSuccess:!0}),f);return()=>clearTimeout(e)},[c,r,g,i]),E.jsx(F,{success:g,errorMessage:S,onRetry:S?.retryable?async()=>{try{o(void 0),p?.telegramAuthModalData?.seamlessAuth||await R(void 0,p?.login?.disableSignup),await T()}catch(e){let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}:void 0})},isCaptchaRequired:!0,isShownBeforeReady:!0};export{Y as TelegramAuthScreen,F as TelegramAuthScreenView,Y as default};
