import{r as l}from"./launchpad.js";import{d5 as d,e4 as m,e5 as u,e6 as h,dd as b,d9 as g}from"./launchpad-App-D179iYht.js";function w(e){return new Uint8Array(m().decode(e).messageBytes)}async function R({solanaClient:e,tx:t}){let r=u().decode(w(t)),{value:n}=await e.rpc.getFeeForMessage(r).send();return n??0n}async function E({solanaClient:e,tx:t,replaceRecentBlockhash:r}){let{value:n}=await e.rpc.simulateTransaction(u().decode(t),{commitment:"confirmed",encoding:"base64",sigVerify:!1,replaceRecentBlockhash:r}).send();if(n.err==="BlockhashNotFound"&&r)throw Error("Simulation failed: Blockhash not found");return n.err==="BlockhashNotFound"?await E({solanaClient:e,tx:t,replaceRecentBlockhash:!0}):{logs:n.logs??[],error:n.err,hasError:!!n.err,hasFunds:n.logs?.every(o=>!/insufficient funds/gi.test(o)&&!/insufficient lamports/gi.test(o))??!0}}const y=(...e)=>{if(typeof Buffer>"u")throw new b("Buffer is not defined.",void 0,g.BUFFER_NOT_DEFINED);return Buffer.from(...e)};async function B({rpcSubscriptions:e,signature:t,timeout:r}){let n=new AbortController,o=await e.signatureNotifications(t,{commitment:"confirmed"}).subscribe({abortSignal:n.signal}),s=await Promise.race([new Promise(a=>{setTimeout(()=>{n.abort(),a(Error("Transaction confirmation timed out"))},r)}),new Promise(async a=>{for await(let c of o){if(n.abort(),c.value.err)return a(Error("Transaction confirmation failed"));a(void 0)}})]);if(s instanceof Error)throw s}function k({rpc:e,rpcSubscriptions:t,chain:r,blockExplorerUrl:n}){let o=function({rpc:s,rpcSubscriptions:a}){return async c=>new Promise(async(f,p)=>{try{let i=await s.sendTransaction(y(c).toString("base64"),{preflightCommitment:"confirmed",encoding:"base64"}).send();await B({rpcSubscriptions:a,signature:i,timeout:1e4}),f({signature:new Uint8Array(h().encode(i))})}catch(i){p(i)}})}({rpc:e,rpcSubscriptions:t});return{rpc:e,rpcSubscriptions:t,chain:r,blockExplorerUrl:n,sendAndConfirmTransaction:o}}function C(){let e=d(),t=l.useMemo(()=>Object.fromEntries(["solana:mainnet","solana:devnet","solana:testnet"].map(r=>[r,e.solanaRpcs[r]?k({chain:r,rpc:e.solanaRpcs[r].rpc,rpcSubscriptions:e.solanaRpcs[r].rpcSubscriptions,blockExplorerUrl:e.solanaRpcs[r].blockExplorerUrl??`https://explorer.solana.com?cluster=${r.replace("solana:","")}`}):null])),[e.solanaRpcs]);return l.useCallback(r=>{if(!t[r])throw Error(`No RPC configuration found for chain ${r}`);return t[r]},[t])}export{w as c,C as d,y as f,R as l,B as p,E as u};
