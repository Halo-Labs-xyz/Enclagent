import{r as a,j as i}from"./launchpad.js";import{F as Se}from"./launchpad-CheckCircleIcon-D2sCnQx5.js";import{c as Te,n as we,s as be}from"./launchpad-Layouts-BlFm53ED-C7q8tWPJ.js";import{u as _}from"./launchpad-ModalHeader-JjfRejxC-CtYe7KE2.js";import{o as xe}from"./launchpad-ScreenHeader-CHmc4-Lu-B284yZ5R.js";import{t as V}from"./launchpad-FundWalletMethodHeader-DRH4o4R5-WL1628h4.js";import{t as Ce}from"./launchpad-index-Dq_xe9dz-DPq0PTtR.js";import{d5 as Y,d6 as ye,d4 as Ee,da as Ne,db as Fe,bu as Ae,cA as $e,dc as je,dd as g,de as B,d9 as v,c as Ue,h as Be,df as Pe,bY as x,dg as ke}from"./launchpad-App-CJN8YHj9.js";import{c as Le,n as We}from"./launchpad-useGetTokenPrice-PWP-Uiot-V0RLikON.js";import{t as G}from"./launchpad-analytics-mkkvFRju-DOXuftJB.js";import{u as K,o as Q,s as Z,r as z,d as J,f as qe}from"./launchpad-reservoir-0wfhnc0j-CPufrqb_.js";import{e as He}from"./launchpad-getChainName-DjpPdUSc-c2urPd0g.js";import{t as Me,n as Re}from"./launchpad-transaction-CnfuREWo-BX0tihxo.js";import{H as De,Z as Oe}from"./launchpad-BridgeNetworkSelectionView-C74EH50n-BwENHH_2.js";import{I as _e}from"./launchpad-TransferOrBridgeLoadingScreen-BKmOAmlN-DfMxSdqV.js";import{c as Ve}from"./launchpad-custom-CEAlFtXp.js";import"./launchpad-useGetSolPrice-DwwjjGbd-BEBGHXwL.js";import"./launchpad-getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./launchpad-getErc20Balance-DA4dGV9O-CmHoS_yx.js";import"./launchpad-Value-tcJV9e0L-D71e5n-9.js";import"./launchpad-LoadingSkeleton-U6-3yFwI-C2YhYO2U.js";import"./launchpad-ErrorMessage-D8VaAP5m-BxUDDoNF.js";import"./launchpad-Subtitle-CV-2yKE4-DzKjSC5T.js";import"./launchpad-Title-BnzYV3Is-D2KM1MN-.js";import"./launchpad-WalletIcon-CmQNtWKM.js";import"./launchpad-Chip-D2-wZOHJ-BUhC-lY9.js";import"./launchpad-shared-FM0rljBt-DH-prbl1.js";import"./launchpad-ChevronDownIcon-D09uGFR6.js";import"./launchpad-formatErc20TokenAmount-BuPk9xcy-CkAr4Oc0.js";import"./launchpad-ethers-VWEScvge-CDamq4Ed.js";import"./launchpad-styles-Dr0J8BuN-BTd1VTPA.js";import"./launchpad-LinkPasskeyScreen-BfLq2-Q5-DEl3FY6W.js";import"./launchpad-TodoList-CgrU7uwu-BTz0vFlH.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";import"./launchpad-check-C5kCRahI.js";import"./launchpad-ScreenLayout-Ca6ml9wY-tWBwodfe.js";import"./launchpad-Screen-DE3ldE_X-Bg_Q5Z_h.js";import"./launchpad-circle-check-big-Bg8vqBbP.js";import"./launchpad-fingerprint-pattern-eZF4302v.js";import"./launchpad-formatters-Ci5UKeAj.js";import"./launchpad-InjectedWalletIcon-DLcYOGDj-DM-O-Fpn.js";import"./launchpad-Address-D-q_5it9-CEPVIheL.js";import"./launchpad-copy-DYa4Op8P.js";import"./launchpad-GlobeAltIcon-DfBLgGP6.js";const Lt={component:()=>{let X=Y(),{rpcConfig:P,appId:I,closePrivyModal:ee,createAnalyticsEvent:k}=ye(),{navigate:te,setModalData:ae,data:d}=Ee(),L=Y(),{wallets:ne}=Ne(),[C,m]=a.useState(null),[ie,y]=a.useState(null),[p,re]=a.useState([]),[W,se]=a.useState(0),[q,E]=a.useState(!1),[H,S]=a.useState(!1),[N,F]=a.useState(!1),[A,M]=a.useState(!1),[oe,de]=a.useState(),[le,R]=a.useState();if(!d?.funding||d.funding.chainType!=="solana")throw Error("Invalid funding data");let{address:u,chain:T,connectedWallet:D}=d.funding,[w,ce]=a.useState(d.funding.amount),t=(D?.type==="ethereum"?D:void 0)??ne[0],ue=Fe(t?.walletClientType||"unknown"),O=ue?.name||"wallet",[l,me]=a.useState(null);a.useEffect(()=>{(async()=>{if(!t)return;let e=await t.getEthereumProvider();me(Ae({account:t.address,transport:Ve(e)}).extend($e))})().catch(console.error)},[t]);let[pe,fe]=a.useState(0n),he=Me(pe);a.useEffect(()=>{let e=X.solanaRpcs[T];e?je({rpc:e.rpc,address:u}).then(s=>fe(BigInt(s))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")},[]);let[n,$]=a.useState(),{tokenPrice:ge}=Le("solana"),{fundingAmountInBaseUnit:b,fundingAmountInUsd:ve}=Re({amount:w,fee:0n,tokenPrice:ge,isUsdc:d.funding.isUSDC});if(a.useEffect(()=>{(async()=>{if(!l||!t)return;let e=["solana:testnet","solana:devnet"].includes(T);e&&console.warn("Solana testnets are not supported for bridging");let s=We(L.chains).filter(({testnet:r})=>!!r===e),f=(await De({chains:s,address:t.address,appId:I,rpcConfig:P})).filter(r=>r.balance>0n);if(f.length<1)return void m(new g(`Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));f.sort((r,U)=>Number(U.balance-r.balance));let o=(await Promise.allSettled(f.map(async r=>({...r,quote:await K({isTestnet:!1,input:Q({appId:I,amount:b.toString(),user:t.address,recipient:u,destinationChainId:z,destinationCurrency:Z,originChainId:r.chain.id})})})))).filter(r=>r.status==="fulfilled").map(r=>r.value);if(o.length<1)return void m(new g(`Unable to fetch quotes for bridging. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));let j=o.map(({quote:r,balance:U,chain:Ie})=>({bridgeTx:J(r),balance:U,chain:Ie,isErc20Quote:!1})).filter(({bridgeTx:r})=>!!r);if(j.length>1)return void re(j);let h=j.at(0);h?(S(!0),$({data:h.bridgeTx.data,to:h.bridgeTx.to,value:h.bridgeTx.value,chain:h.chain})):m(new g(`Unable to select bridge option from quotes. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE))})().catch(console.error)},[l]),a.useEffect(()=>{(async()=>{let e,s;if(!l||!t||q||N||!n)return;E(!0);let f=Ue({chain:n.chain,transport:Be(Pe(n.chain,P,I))});try{e=await f.prepareTransactionRequest({account:t.address,to:n.to,chain:n.chain,data:n.data,value:BigInt(n.value??0)})}catch(o){console.error(o),p.length>1&&y(o.shortMessage??"Something went wrong")}if(e){E(!1),F(!0);try{await l.switchChain({id:n.chain.id})}catch{await l.addChain({chain:n.chain}),await l.switchChain({id:n.chain.id})}try{s=await l.sendTransaction(e)}catch(o){console.error(o),o.name==="TransactionExecutionError"&&(p.length<1?m(new g(o.shortMessage,void 0,v.TRANSACTION_FAILURE)):y(o.shortMessage??"Something went wrong"))}if(s)return await l.waitForTransactionReceipt({hash:s}),H?(R("pending"),void de(s)):(F(!1),M(!0),void k({eventName:G,payload:{provider:"external",status:"success",txHash:s,address:t.address,chainId:n.chain.id,chainType:"ethereum",value:n.value?x(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:x(b,9),destinationToken:"SOL"}}));F(!1)}else E(!1)})().catch(console.error)},[l,n]),qe({transactionHash:oe,isTestnet:!1,bridgingStatus:le,setBridgingStatus:R,onSuccess({transactionHash:e}){S(!1),M(!0),k({eventName:G,payload:{provider:"external",status:"success",txHash:e,address:t?.address,chainId:n?.chain.id,chainType:"ethereum",value:n?.value?x(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:x(b,9),destinationToken:"SOL"}})},onFailure({error:e}){S(!1),m(e)}}),a.useEffect(()=>{C&&(ae({funding:d?.funding,solanaFundingData:d?.solanaFundingData,sendTransaction:d?.sendTransaction,errorModalData:{error:C,previousScreen:"TransferFromWalletScreen"}}),te("ErrorScreen",!1))},[C]),a.useEffect(()=>{if(!A)return;let e=setTimeout(ee,ke);return()=>clearTimeout(e)},[A]),A)return i.jsxs(i.Fragment,{children:[i.jsx(V,{}),i.jsx(Te,{}),i.jsxs(we,{children:[i.jsx(Se,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),i.jsx(xe,{title:"Success!",description:`Youâ€™ve successfully added ${w} SOL to your ${L.name} wallet. It may take a minute before the funds are available to use.`})]}),i.jsx(be,{}),i.jsx(_,{})]});let c=p[W];return p.length>1&&c?i.jsx(Oe,{displayName:O,configuredFundingChain:T,formattedBalance:he,fundingAmount:w,fundingCurrency:"SOL",fundingAmountInUsd:ve,options:p,selectedOption:c,isPreparing:q,isSubmitting:N,addressToFund:u,fundingWalletAddress:t?.address||"",errorMessage:ie,onSubmit:()=>{d.funding?.amount!==w?async function(){if(t&&c)try{let e=await K({isTestnet:!1,input:Q({appId:I,amount:b.toString(),user:t.address,recipient:u,destinationChainId:z,destinationCurrency:Z,originChainId:c.chain.id})}),s=J(e);if(!s)throw Error("Invalid transaction request");S(!0),$({data:s.data,to:s.to,value:s.value,chain:c.chain})}catch(e){console.error(e),m(new g("Unable to fetch quotes for bridging",e,v.INSUFFICIENT_BALANCE))}}().catch(console.error):$({to:c.bridgeTx.to,data:c.bridgeTx.data,value:c.bridgeTx.value,chain:c.chain})},onSelect:e=>{e!==W&&(y(null),se(e))},onAmountChange:ce}):N&&t?i.jsx(_e,{walletClientType:t?.walletClientType||"unknown",displayName:O,addressToFund:u,isBridging:H,isErc20Flow:!1,chainId:"solana",chainName:He(T),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):i.jsxs(i.Fragment,{children:[i.jsx(V,{}),i.jsx(Ce,{}),i.jsx("div",{style:{marginTop:"1rem"}}),i.jsx(_,{})]})}};export{Lt as AwaitingEvmToSolBridgingScreen,Lt as default};
