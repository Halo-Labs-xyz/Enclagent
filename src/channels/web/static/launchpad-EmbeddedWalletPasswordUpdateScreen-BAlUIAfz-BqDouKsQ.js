import{r as a,j as U}from"./launchpad.js";import{dy as j,d6 as T,d4 as V,d5 as $,dT as M,dU as k,dV as L,dS as y}from"./launchpad-App-CJN8YHj9.js";import{u as W,o as D}from"./launchpad-SetWalletPasswordForm-C2hZtfwu-CVQpVFn-.js";import"./launchpad-ExclamationTriangleIcon-DS9jnCFw.js";import"./launchpad-Layouts-BlFm53ED-C7q8tWPJ.js";import"./launchpad-ModalHeader-JjfRejxC-CtYe7KE2.js";import"./launchpad-shared-BcHk2XA3-Dedc-zDW.js";import"./launchpad-Checkbox-BhNoOKjX-DH1QEOI4.js";import"./launchpad-CheckCircleIcon-BvqP64EM.js";import"./launchpad-ScreenHeader-CHmc4-Lu-B284yZ5R.js";const Y={component:()=>{let[n,R]=a.useState(null),[S,w]=a.useState(!1),[l,o]=a.useState(null),[i,v]=a.useState(""),{authenticated:m,user:c}=j(),{client:b,walletProxy:h,refreshSessionAndUser:P,closePrivyModal:d,createAnalyticsEvent:r}=T(),{navigate:x,data:E,onUserCloseViaDialogOrKeybindRef:C}=V(),I=$(),{onSuccess:f,onFailure:u}=E.setWalletPassword,e=M(c),g=n?.recoveryMethod==="user-passcode",t=e?.recoveryMethod==="user-passcode";a.useEffect(()=>{m||(x("LandingScreen"),u(new k("User must be authenticated before setting a password on a Privy wallet")))},[m]);let p=()=>l?(u(l),void d({shouldCallAuthOnSuccess:!1})):g?(f(n),void d({shouldCallAuthOnSuccess:!1})):(u(new y("Exited before password was added to wallet")),void d({shouldCallAuthOnSuccess:!1}));return C.current=p,U.jsx(W,{appName:I?.name||"privy",config:{initiatedBy:"user",onCancel:p},error:l?"An error has occurred, please try again.":void 0,buttonLoading:S,buttonHideAnimations:!1,password:i,isResettingPassword:t,onPasswordGenerate:()=>v(D()),onPasswordChange:v,onSubmit:async()=>{g?(f(n),d({shouldCallAuthOnSuccess:!1})):(w(!0),o(null),await(async()=>{let _=await b.getAccessToken();if(_&&c&&e?.address&&i&&h)try{r({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}});let{entropyId:s,entropyIdVerifier:N}=L(c);if(!(await h.setRecovery({accessToken:_,entropyId:s,entropyIdVerifier:N,recoveryPassword:i,recoveryMethod:"user-passcode"})).entropyId)return o(new y("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"error setting password"}});let O=await P(),A=M(O);if(!A)return o(new y("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"wallet disconnected"}});R(A),r({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}})}catch(s){console.warn(s),o(s instanceof Error?s:Error("Error setting password on privy wallet")),r({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:e.address,reason:s}})}})(),w(!1))},onClose:p})}};export{Y as EmbeddedWalletPasswordUpdateScreen,Y as default};
