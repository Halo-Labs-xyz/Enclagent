import{r,j as d}from"./launchpad.js";import{F as qe}from"./launchpad-CheckCircleIcon-D2sCnQx5.js";import{c as De,n as _e,s as Le}from"./launchpad-Layouts-BlFm53ED-C7q8tWPJ.js";import{u as ne}from"./launchpad-ModalHeader-JjfRejxC-CtYe7KE2.js";import{o as Re}from"./launchpad-ScreenHeader-CHmc4-Lu-B284yZ5R.js";import{t as re}from"./launchpad-FundWalletMethodHeader-DRH4o4R5-WL1628h4.js";import{t as Qe}from"./launchpad-index-Dq_xe9dz-DPq0PTtR.js";import{d6 as Ye,d4 as Ke,d5 as Ze,da as Oe,db as Ve,bu as Je,cA as ze,c as ie,h as se,df as oe,bK as Ge,dd as S,de as F,d9 as x,dh as de,bY as W,dg as Xe}from"./launchpad-App-CJN8YHj9.js";import{c as et,n as tt}from"./launchpad-useGetTokenPrice-PWP-Uiot-V0RLikON.js";import{t as ce,a as at}from"./launchpad-transfer-6YztDh-t-DU6hH7CZ.js";import{t as nt}from"./launchpad-formatErc20TokenAmount-BuPk9xcy-CkAr4Oc0.js";import{n as rt,o as le,c as R,l as it}from"./launchpad-ethers-VWEScvge-CDamq4Ed.js";import{t as ue}from"./launchpad-analytics-mkkvFRju-DOXuftJB.js";import{o as Q,u as me,d as fe,f as st}from"./launchpad-reservoir-0wfhnc0j-CPufrqb_.js";import{H as ot,Z as dt}from"./launchpad-BridgeNetworkSelectionView-C74EH50n-BwENHH_2.js";import{n as ct}from"./launchpad-getErc20Balance-DA4dGV9O-CmHoS_yx.js";import{I as lt}from"./launchpad-TransferOrBridgeLoadingScreen-BKmOAmlN-DfMxSdqV.js";import{p as ut}from"./launchpad-parseEther-C_fw9aAj.js";import{c as mt}from"./launchpad-custom-CEAlFtXp.js";import"./launchpad-useGetSolPrice-DwwjjGbd-BEBGHXwL.js";import"./launchpad-Value-tcJV9e0L-D71e5n-9.js";import"./launchpad-LoadingSkeleton-U6-3yFwI-C2YhYO2U.js";import"./launchpad-ErrorMessage-D8VaAP5m-BxUDDoNF.js";import"./launchpad-Subtitle-CV-2yKE4-DzKjSC5T.js";import"./launchpad-Title-BnzYV3Is-D2KM1MN-.js";import"./launchpad-WalletIcon-CmQNtWKM.js";import"./launchpad-getChainName-DjpPdUSc-c2urPd0g.js";import"./launchpad-Chip-D2-wZOHJ-BUhC-lY9.js";import"./launchpad-shared-FM0rljBt-DH-prbl1.js";import"./launchpad-ChevronDownIcon-D09uGFR6.js";import"./launchpad-styles-Dr0J8BuN-BTd1VTPA.js";import"./launchpad-LinkPasskeyScreen-BfLq2-Q5-DEl3FY6W.js";import"./launchpad-TodoList-CgrU7uwu-BTz0vFlH.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";import"./launchpad-check-C5kCRahI.js";import"./launchpad-ScreenLayout-Ca6ml9wY-tWBwodfe.js";import"./launchpad-Screen-DE3ldE_X-Bg_Q5Z_h.js";import"./launchpad-circle-check-big-Bg8vqBbP.js";import"./launchpad-fingerprint-pattern-eZF4302v.js";import"./launchpad-formatters-Ci5UKeAj.js";import"./launchpad-InjectedWalletIcon-DLcYOGDj-DM-O-Fpn.js";import"./launchpad-Address-D-q_5it9-CEPVIheL.js";import"./launchpad-copy-DYa4Op8P.js";import"./launchpad-GlobeAltIcon-DfBLgGP6.js";const na={component:()=>{let{rpcConfig:j,appId:y,closePrivyModal:he,createAnalyticsEvent:Y}=Ye(),{navigate:pe,setModalData:H,data:o}=Ke(),K=Ze(),{wallets:ge}=Oe(),[ve,ye]=r.useState(!1),[C,Ce]=r.useState(0n),[Z,O]=r.useState(!1),[P,g]=r.useState(null),[Ie,M]=r.useState(null),[T,Te]=r.useState([]),[V,be]=r.useState(0),[J,$]=r.useState(!1),[q,B]=r.useState(!1),[z,D]=r.useState(!1),[_,G]=r.useState(!1),[we,Ee]=r.useState(),[Se,X]=r.useState();if(!o?.funding||o.funding.chainType!=="ethereum")throw Error("Invalid funding data");let{erc20ContractInfo:s,chain:t,connectedWallet:ee}=o.funding,h=o.funding.address,m=o.funding.erc20Address,[b,xe]=r.useState(o.funding.amount);r.useEffect(()=>{m&&!s&&g(Error("Unable to fetch token details"))},[]);let c=!!m&&!!s,f=c?BigInt(parseFloat(b)*10**s.decimals):ut(b),a=(ee?.type==="ethereum"?ee:void 0)??ge[0],$e=Ve(a?.walletClientType||"unknown"),te=$e?.name||"wallet",[v,Ne]=r.useState(null);r.useEffect(()=>{(async()=>{if(!a)return;let n=await a.getEthereumProvider();Ne(Je({account:a.address,transport:mt(n)}).extend(ze))})().catch(console.error)},[a]);let[Ae,Fe]=r.useState(0n);r.useEffect(()=>{ie({chain:t,transport:se(oe(t,j,y))}).getBalance({address:h}).then(Fe).catch(console.error)},[]);let[je,Be]=r.useState(0n);r.useEffect(()=>{c&&ct({chain:t,address:h,appId:y,rpcConfig:j,erc20Address:m}).then(n=>Be(n.balance)).catch(console.error)},[]);let{tokenPrice:w}=et(t.id),[i,U]=r.useState({to:h,chain:t,value:f,data:void 0});r.useEffect(()=>{(async()=>{let n,u;if(!v||!a||J||z)return;$(!0);let I=ie({chain:i.chain,transport:se(oe(i.chain,j,y))});if(c&&!i.data)return await I.simulateContract({address:m,chain:i.chain,abi:ce,functionName:"transfer",args:[h,f],account:a.address}).catch(l=>{if(l?.cause?.name==="ContractFunctionZeroDataError"||l?.message?.includes("returned no data"))return I.simulateContract({address:m,chain:i.chain,abi:at,functionName:"transfer",args:[h,f],account:a.address}).catch(E=>{console.warn("Simulated token transfer failed with error, fetching bridge options.",E)});console.warn("Simulated token transfer failed with error, fetching bridge options.",l)})?($(!1),void U({to:m,chain:i.chain,data:Ge({abi:ce,functionName:"transfer",args:[h,f]}),value:"0x0"})):($(!1),void O(!0));try{n=await I.prepareTransactionRequest({account:a.address,to:i.to,chain:i.chain,data:i.data,value:BigInt(i.value??0)})}catch(l){if(console.error(l),T.length>1)M(l.shortMessage??"Something went wrong");else if(q&&T.length===0)return void g(new S(`Wallet ${F(a.address)} does not have enough funds.`,void 0,x.INSUFFICIENT_BALANCE))}if(!n)return $(!1),void O(!0);$(!1),D(!0),ye(!0),Ce(n.gas);try{await v.switchChain({id:i.chain.id})}catch{await v.addChain({chain:i.chain}),await v.switchChain({id:i.chain.id})}try{u=await v.sendTransaction(n)}catch(l){if(console.error(l),l.name==="TransactionExecutionError")if(T.length<1){let E=l.shortMessage;(l.shortMessage.includes("rejected the request")||l.details.includes("rejected the request"))&&(E="User rejected the request."),g(new S(E,void 0,x.TRANSACTION_FAILURE))}else M(l.shortMessage??"Something went wrong")}if(u)return await v.waitForTransactionReceipt({hash:u}),D(!1),q?(Ee(u),void X("pending")):(G(!0),H(de(o,"completed",u,a?.walletClientType,c,s,t)),void Y({eventName:ue,payload:{provider:"external",status:"success",txHash:u,address:a.address,chainId:i.chain.id,chainType:"ethereum",value:i.value?W(BigInt(i.value),s?.decimals??18):void 0,token:s?.symbol??m??"ETH",destinationAddress:h,destinationChainId:t.id,destinationChainType:"ethereum",destinationValue:f?W(f,s?.decimals??18):void 0,destinationToken:s?.symbol??m??t.nativeCurrency.name}}));D(!1)})().catch(console.error)},[v,i]),r.useEffect(()=>{(async()=>{if(!Z||!v||!a)return;let n=tt(K.chains).filter(e=>e.id!==t.id&&!!e.testnet==!!t.testnet);c&&n.unshift(t);let u=await ot({chains:n,address:a.address,appId:y,rpcConfig:j,includeUsdc:o.funding?.isUSDC}),I=c?u.filter(e=>e.balance>0n):u.filter(e=>e.balance>f),l=c&&u.every(e=>e.balance===0n);if(I.length<1)return void g(new S(l?`Wallet ${F(a.address)} doesn't have enough funds to cover gas fees. Top up your wallet and try again.`:`Wallet ${F(a.address)} does not have enough funds.`,void 0,x.INSUFFICIENT_BALANCE));I.sort((e,A)=>Number(c?(A.erc20Balance??0n)-(e.erc20Balance??0n):A.balance-e.balance));let E=I.flatMap(e=>{let A=[{...e,isErc20Quote:!1,isTestnet:!!t.testnet,input:Q({appId:y,amount:f.toString(),user:a.address,recipient:h,destinationChainId:t.id,destinationCurrency:m,originChainId:e.chain.id})}];return c&&m&&(e.erc20Balance??0n)>=f&&A.push({...e,isErc20Quote:!0,isTestnet:!!t.testnet,input:Q({appId:y,amount:f.toString(),user:a.address,recipient:h,destinationChainId:t.id,destinationCurrency:m,originChainId:e.chain.id,originCurrency:e.erc20Address})}),A}),ae=(await Promise.allSettled(E.map(async e=>({...e,quote:await me(e)})))).filter(e=>e.status==="fulfilled").map(e=>e.value);if(ae.length<1)return void g(new S(`Wallet ${F(a.address)} does not have enough funds.`,void 0,x.INSUFFICIENT_BALANCE));let L=ae.map(e=>({bridgeTx:fe(e.quote),balance:e.balance,chain:e.chain,erc20Balance:e.erc20Balance,isErc20Quote:e.isErc20Quote})).filter(e=>!!e.bridgeTx);if(L.length>1)return void Te(L);let N=L[0];N?(B(!0),U({data:N.bridgeTx.data,to:N.bridgeTx.to,value:N.bridgeTx.value,chain:N.chain})):g(new S(`Wallet ${F(a.address)} does not have enough funds.`,void 0,x.INSUFFICIENT_BALANCE))})().catch(console.error)},[Z]),st({transactionHash:we,isTestnet:!!t.testnet,bridgingStatus:Se,setBridgingStatus:X,onSuccess({transactionHash:n}){B(!1),G(!0),H(de(o,"completed",n,a?.walletClientType,c,s,t)),Y({eventName:ue,payload:{provider:"external",status:"success",txHash:n,address:a?.address,chainId:i.chain.id,chainType:"ethereum",value:i.value?W(BigInt(i.value),s?.decimals??18):void 0,token:s?.symbol??m??"ETH",destinationAddress:h,destinationChainId:t.id,destinationChainType:"ethereum",destinationValue:f?W(f,s?.decimals??18):void 0,destinationToken:s?.symbol??m??t.nativeCurrency.name}})},onFailure({error:n}){B(!1),g(n)}}),r.useEffect(()=>{P&&(H({funding:o?.funding,solanaFundingData:o?.solanaFundingData,sendTransaction:o?.sendTransaction,errorModalData:{error:P,previousScreen:"TransferFromWalletScreen"}}),pe("ErrorScreen",!1))},[P]);let Ue=!c&&w?rt(b??"0",w):void 0,k=c?C:it([C,f]),ke=k&&w?le(k,w):void 0,We=k?R(k,o?.funding?.erc20Address?o?.funding?.erc20ContractInfo?.symbol||"ETH":o?.funding?.chain.nativeCurrency.symbol||"ETH"):void 0,He=C&&w?le(C,w):void 0,Pe=C?R(C,t?.nativeCurrency?.symbol||"ETH"):void 0;if(r.useEffect(()=>{if(!_)return;let n=setTimeout(he,Xe);return()=>clearTimeout(n)},[_]),_)return d.jsxs(d.Fragment,{children:[d.jsx(re,{}),d.jsx(De,{}),d.jsxs(_e,{children:[d.jsx(qe,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),d.jsx(Re,{title:"Success!",description:`Youâ€™ve successfully added ${b} ${c?s.symbol:t.nativeCurrency.symbol} to your ${K.name} wallet. It may take a minute before the funds are available to use.`})]}),d.jsx(Le,{}),d.jsx(ne,{})]});let Me=c?`${nt({amount:je,decimals:s.decimals})}  ${s.symbol}`:R(Ae,t.nativeCurrency.symbol,3,!0),p=T[V];return T.length>1&&p?d.jsx(dt,{displayName:te,configuredFundingChain:t,erc20ContractInfo:s,formattedBalance:Me,fundingAmount:b,fundingCurrency:c?s.symbol:t.nativeCurrency.symbol,fundingAmountInUsd:Ue,options:T,selectedOption:p,isPreparing:J,isSubmitting:z,addressToFund:h,fundingWalletAddress:a?.address||"",errorMessage:Ie,onSubmit:()=>{o.funding?.amount!==b?async function(){if(a&&p)try{let n=await me({isTestnet:!!t.testnet,input:Q({appId:y,amount:f.toString(),user:a.address,recipient:h,destinationChainId:t.id,destinationCurrency:m,originChainId:p.chain.id})}),u=fe(n);if(!u)throw Error("Invalid transaction request");B(!0),U({data:u.data,to:u.to,value:u.value,chain:p.chain})}catch(n){console.error(n),g(new S("Unable to fetch quotes for bridging",n,x.INSUFFICIENT_BALANCE))}}().catch(console.error):U({to:p.bridgeTx.to,data:p.bridgeTx.data,value:p.bridgeTx.value,chain:p.chain})},onSelect:n=>{n!==V&&(M(null),be(n))},onAmountChange:xe}):ve&&C&&a&&o?.funding?d.jsx(lt,{walletClientType:a?.walletClientType||"unknown",displayName:te,addressToFund:h,isBridging:q,isErc20Flow:c,totalPriceInUsd:ke,totalPriceInNativeCurrency:We,gasPriceInUsd:He,gasPriceInNativeCurrency:Pe,chainId:t.id,chainName:t.name}):d.jsxs(d.Fragment,{children:[d.jsx(re,{}),d.jsx(Qe,{}),d.jsx("div",{style:{marginTop:"1rem"}}),d.jsx(ne,{})]})}};export{na as AwaitingExternalEthereumTransferScreen,na as default};
