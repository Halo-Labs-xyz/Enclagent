import{r as o,j as d}from"./launchpad.js";import{dy as B,d5 as j,d4 as F}from"./launchpad-App-D179iYht.js";import{K as V,R as P,q as D,X as S}from"./launchpad-to-ui-error-CmP4i4IC-CtfAtO2K.js";import"./launchpad-PinInput-3SLvbnQa-CovKtgDb.js";import"./launchpad-FingerPrintIcon-CpCeQsPn.js";import"./launchpad-PhoneIcon-C1ddPHdQ.js";import"./launchpad-ShieldCheckIcon-CP_2fGKU.js";import"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import"./launchpad-ExclamationTriangleIcon-DS9jnCFw.js";import"./launchpad-StackedContainer-B2vaEl56-DAGpnjTg.js";import"./launchpad-useGetTokenPrice-PWP-Uiot-DSryU3xF.js";import"./launchpad-useGetSolPrice-DwwjjGbd-C6EP3HJh.js";import"./launchpad-TransactionDetails-DkPozym_-DJ9OmnKi.js";import"./launchpad-WalletLink-B12jNftF-DRQ54pOI.js";import"./launchpad-ethers-VWEScvge-ty8Zt0i3.js";import"./launchpad-getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./launchpad-transaction-CnfuREWo-BX0tihxo.js";import"./launchpad-Layouts-BlFm53ED-HTJjrY9f.js";import"./launchpad-ChevronDownIcon-D09uGFR6.js";const te={component:()=>{let{user:l}=B(),y=j(),a=o.useMemo(()=>l?.mfaMethods.filter(e=>e!=="passkey"||!y.globalDisablePasskeys)??[],[l?.mfaMethods,y.globalDisablePasskeys]),{data:h}=F(),[t,s]=o.useState(a[0]),[f,k]=o.useState(!1),[m,M]=o.useState(),[n,i]=o.useState();if(o.useEffect(()=>{s(a[0])},[a]),!h?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:E,onSuccess:c,generateOptions:b,verifyTotpCode:C,verifyPasskey:v,verifySmsCode:x,sendSmsCode:A}=h.mfaVerify,g=async e=>{if(e!=="passkey")try{s(e),e==="sms"&&(s(e),await A()),e==="totp"&&s(e)}catch(r){console.error(r)}else try{s(e);let r=await b();if(!r)throw Error("something went wrong");M(r),await v(r),k(!0),i(void 0),c()}catch(r){i(S(r))}},w=async e=>{i(void 0);try{if(!e||!t)return;if(t==="passkey"){if(!m)throw Error("Missing passkey challenge");await v(m)}else t==="sms"?await x(e):t==="totp"&&await C(e);i(void 0),k(!0),c()}catch(r){throw S(r).error}},p=()=>{n||!f?E(n?.error??Error("Canceled MFA verification.")):c()},u=o.useRef(!1);return o.useEffect(()=>{!u.current&&t&&(u.current=!0,g(t).finally(()=>{u.current=!1}))},[open]),l?t==="passkey"?d.jsx(V,{account:l.linkedAccounts.filter(e=>e.type==="passkey"&&e.enrolledInMfa).sort((e,r)=>r.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf())[0],submitSuccess:f,hasBlockingError:n?.isBlocking??!1,error:n?.error,onClose:p,onBack:()=>{s(void 0),i(void 0)},handleSubmit:()=>w(m).catch(i)}):t==="sms"||t==="totp"?d.jsx(P,{selectedMethod:t,submitSuccess:f,hasBlockingError:n?.isBlocking??!1,handleSubmitCode:w,onClose:p,onBack:a.length>1?()=>s(void 0):void 0}):d.jsx(D,{mfaMethods:a,onSelect:g,handleClose:p}):null}};export{te as MfaAuthVerifyFlowScreen,te as default};
