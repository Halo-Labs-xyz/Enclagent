import{r as d,j as C}from"./launchpad.js";import{d5 as I,d4 as T,d6 as U,dI as E,dd as A,dJ as $,du as h,dK as x,d9 as O}from"./launchpad-App-CJN8YHj9.js";import{a as R}from"./launchpad-shouldProceedtoEmbeddedWalletCreationFlow-BsPl2jCD-4dyd-DVQ.js";import{n as W}from"./launchpad-ScreenLayout-Ca6ml9wY-tWBwodfe.js";import"./launchpad-ModalHeader-JjfRejxC-CtYe7KE2.js";import"./launchpad-Screen-DE3ldE_X-Bg_Q5Z_h.js";import"./launchpad-index-Dq_xe9dz-DPq0PTtR.js";const _=({providerApp:a,success:s,error:r,onClose:c})=>{let{title:i,subtitle:u}=d.useMemo(()=>s?{title:`Successfully connected with ${a.name}`,subtitle:"You're good to go!"}:r?{title:"Authentication failed",subtitle:r.message}:{title:`Connecting to ${a.name}`,subtitle:`Please check the pop-up from ${a.name} to continue`},[s,r,a.name]);return C.jsx(W,{title:i,subtitle:u,icon:a.logoUrl,iconVariant:"loading",iconLoadingStatus:{success:s,fail:!!r},onBack:c,watermark:!0})},V={component:()=>{let a=I(),{data:s,navigate:r,setModalData:c,onUserCloseViaDialogOrKeybindRef:i}=T(),{crossAppAuthFlow:u,updateWallets:y,closePrivyModal:g,createAnalyticsEvent:b}=U(),{logout:v}=E(),[o,n]=d.useState({}),e=s?.crossAppAuth,p=new A(`There was an issue connecting your ${e?.name} account. Please try again.`),w=new $(async l=>{if(e?.popup)try{let t=await u({appId:l,popup:e.popup,action:e.action,disableSignup:e.disableSignup});n({data:t})}catch(t){if(t instanceof A)n({error:t});else if(t instanceof x){if(t.privyErrorCode===O.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce)return c({accountTransfer:{nonce:t.data?.data?.nonce,account:t.data?.data?.subject,displayName:t.data?.data?.account?.displayName,linkMethod:`privy:${e.appId}`,embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:t.data?.data?.otherUser?.oAuthUserInfo}}),void r("LinkConflictScreen");e.popup&&e.popup.close(),n({error:p})}else n({error:p})}else n({error:p})}),m=()=>{o.data&&(y(),e?.onSuccess(o.data),g({shouldCallAuthOnSuccess:!0,isSuccess:!0})),e?.onError(o.error??new A("User canceled flow")),g({shouldCallAuthOnSuccess:!1,isSuccess:!1})};return i.current=m,d.useEffect(()=>{e?.appId?.length&&w.execute(e.appId)},[e?.appId]),d.useEffect(()=>{if(!o.data)return;let l=o.data;if(a.legal.requireUsersAcceptTerms&&!l.hasAcceptedTerms){let f=setTimeout(()=>{r("AffirmativeConsentScreen")},h);return()=>clearTimeout(f)}if(R(l,a.embeddedWallets)){let f=setTimeout(()=>{c({createWallet:{onSuccess:()=>{},onFailure:S=>{console.error(S),b({eventName:"embedded_wallet_creation_failure_logout",payload:{error:S,provider:`privy:${e?.appId}`,screen:"CrossAppAuthScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")},h);return()=>clearTimeout(f)}let t=setTimeout(m,h);return()=>clearTimeout(t)},[o.data]),e?.appId?C.jsx(_,{providerApp:{id:e?.appId,logoUrl:e?.logoUrl,name:e?.name},success:!!o.data,error:o.error,onClose:m}):(console.warn("Missing data for Screen"),null)},isShownBeforeReady:!0};export{V as CrossAppAuthScreen,_ as CrossAppAuthScreenView,V as default};
