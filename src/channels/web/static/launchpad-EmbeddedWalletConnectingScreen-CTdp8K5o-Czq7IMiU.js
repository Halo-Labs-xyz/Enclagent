import{r as p,j as I}from"./launchpad.js";import{dy as k,d6 as V,d4 as P,dL as g,dM as M}from"./launchpad-App-D179iYht.js";import{n as U}from"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import{C as _}from"./launchpad-circle-x-DddvhjMS.js";import"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";const j=({connectionFailed:i,onClose:s})=>I.jsx(U,i?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:_,iconVariant:"error",primaryCta:{label:"Close",onClick:s},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:s,watermark:!1}),X={component:()=>{let{authenticated:i,user:s}=k(),{client:f,closePrivyModal:u,createAnalyticsEvent:m,walletProxy:o}=V(),{navigate:n,data:v,setModalData:A,onUserCloseViaDialogOrKeybindRef:E}=P(),x=p.useMemo(()=>Date.now(),[]),[w,F]=p.useState(!1),{onCompleteNavigateTo:t,onFailure:h,shouldForceMFA:S,entropyId:c,entropyIdVerifier:d,recoveryMethod:l,connectingWalletAddress:b,isUnifiedWallet:T=!1}=v?.connectWallet,e=r=>{w||(F(!0),h(typeof r=="string"?Error(r):r))};return p.useEffect(()=>{let r;return i?o?((async()=>{let y=await f.getAccessToken();if(!y)return e("User must be authenticated and have a Privy wallet before it can be connected");try{if(!T){if(!c||!d)return e("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await o.connect({accessToken:y,entropyId:c,entropyIdVerifier:d})}S&&await o.verifyMfa({accessToken:y});let a=(Date.now()-x)/1e3;t==="EmbeddedWalletKeyExportScreen"&&a<1?r=setTimeout(()=>{n(t,!1)},1e3*(1-a)):n(t,!1)}catch(a){if(g(a)&&l==="privy"){let C=await f.getAccessToken();if(!C)return e("User must be authenticated and have a Privy wallet before it can be recovered");try{m({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:b}}),(await o?.recover({accessToken:C,entropyId:c,entropyIdVerifier:d}))?.entropyId||e(Error("Unable to recover wallet")),t?n(t):u({shouldCallAuthOnSuccess:!1}),m({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:b}}),n(t)}catch{e("An error has occurred, please try again.")}}else g(a)&&l!=="privy"&&l!=="privy-v2"?(A({...v,recoverWallet:{entropyId:c,entropyIdVerifier:d,onCompleteNavigateTo:t,onFailure:h},recoveryOAuthStatus:{provider:l,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}}),n(M(l))):e(a)}})(),()=>clearTimeout(r)):void 0:e("User must be authenticated and have a Privy wallet before it can be connected")},[i,s,o]),E.current=()=>{e("User exited before wallet could be connected"),u({shouldCallAuthOnSuccess:!1})},I.jsx(j,{connectionFailed:w,onClose:()=>u({shouldCallAuthOnSuccess:!1})})}};export{X as EmbeddedWalletConnectingScreen,j as EmbeddedWalletConnectingView,X as default};
