import{r as l,j as e}from"./launchpad.js";import{T as y,g as x,F as U,m as M}from"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import{F as G}from"./launchpad-ShieldCheckIcon-CP_2fGKU.js";import{dy as J,d4 as Q,d5 as X,dr as Y}from"./launchpad-App-D179iYht.js";import{t as Z,f as _,l as ee,i as te}from"./launchpad-EnrollTotp-COmXYzq5-DDWyTrZe.js";import{a as re,d as oe,w as F,l as C,p as R,m as S}from"./launchpad-PinInput-3SLvbnQa-CovKtgDb.js";import"./launchpad-QrCode-VCBMkqqq-DYkl2ssX.js";import"./launchpad-FingerPrintIcon-CpCeQsPn.js";import"./launchpad-PhoneIcon-C1ddPHdQ.js";import"./launchpad-Chip-D2-wZOHJ-C13jw6H6.js";import"./launchpad-LoadingSkeleton-U6-3yFwI-De_7LaVb.js";import"./launchpad-ErrorScreen-V8ec2dKP-DjcwwqNu.js";import"./launchpad-reservoir-0wfhnc0j-DglEJspj.js";import"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";import"./launchpad-lock-DOKCRgid.js";import"./launchpad-LinkPasskeyScreen-BfLq2-Q5-CD3LfYpW.js";import"./launchpad-TodoList-CgrU7uwu-SiSPC2Wo.js";import"./launchpad-check-C5kCRahI.js";import"./launchpad-circle-check-big-Bg8vqBbP.js";import"./launchpad-fingerprint-pattern-eZF4302v.js";import"./launchpad-CopyToClipboard-DSTf_eKU-kZApe455.js";import"./launchpad-Layouts-BlFm53ED-HTJjrY9f.js";import"./launchpad-LabelXs-oqZNqbm_-D2WTgiPX.js";import"./launchpad-Subtitle-CV-2yKE4-xZAXWUw0.js";import"./launchpad-Title-BnzYV3Is-Bc_Ic5pg.js";import"./launchpad-shared-FM0rljBt-BThDrsH1.js";import"./launchpad-dijkstra-D_NXgYpA.js";const Ue={component:()=>{let{user:s,ready:B}=J(),{data:j,onUserCloseViaDialogOrKeybindRef:I}=Q(),m=X(),[v,i]=l.useState(null),[h,p]=l.useState(null),[g,k]=l.useState(null),[W,L]=l.useState(!1),[b,n]=l.useState(!1),[f,o]=l.useState(),a=async()=>{f?E(f):s?await c({user:s}):E(Error("Must be logged in to manage MFA")),setTimeout(()=>{i(null),p(null)},500)};if(I.current=a,!j?.mfaEnroll)throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:E,onSuccess:c,onBack:w,mfaMethods:O,verify:A,generateTotpSecret:D,enrollTotp:H,unenrollTotp:K,enrollPasskey:$}=j.mfaEnroll,N=s?.mfaMethods.includes("sms"),V=s?.mfaMethods.includes("totp"),q=s?.mfaMethods.includes("passkey"),z=!!s?.phone,T=s?.linkedAccounts.filter(t=>t.type==="passkey").map(t=>t.credentialId)??[];function d(){i(null),p(null),o(void 0)}async function P(t=T){try{o(void 0),n(!0);let r=await $(t);return await c({user:r})}catch(r){o(r)}finally{n(!1),L(!1)}}if(!B||!s||!m)return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:a,backFn:w},"header"),e.jsx(re,{children:e.jsx(Z,{})}),e.jsx(oe,{children:e.jsx(Y,{})}),e.jsx(x,{})]});if(v==="sms")return null;if(v==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:a},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(C,{children:"Remove authenticator app verification?"}),e.jsxs(R,{children:["MFA adds an extra layer of security to your ",m?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(S,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{o(void 0),n(!0);let t=await K();return await c({user:t})}catch(t){o(t)}finally{n(!1),i(null)}},loading:b,children:"Remove"})}),e.jsx(x,{})]});if(v==="passkey"){let t=j.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:a},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(C,{children:"Are you sure you want to remove this passkey?"}),e.jsx(R,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(S,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{o(void 0),n(!0);let r=await $([]);return await c({user:r})}catch(r){o(r)}finally{n(!1),i(null)}},loading:b,children:"Remove"})}),e.jsx(x,{})]})}return O.length!==0||N||V||q?h==="sms"?null:h==="totp"&&g?e.jsx(_,{onClose:a,onReset:d,submitEnrollmentWithTotp:t=>async function(r){try{o(void 0),n(!0);let u=await H(r);return await c({user:u})}catch(u){o(u)}finally{n(!1),i(null)}}(t.mfaCode),error:f,totpInfo:{...g,appName:m?.name||"Privy"}}):h==="passkey"?e.jsx(ee,{onReset:d,onClose:a,submitEnrollmentWithPasskey:P}):e.jsx(te,{showIntro:!0,userMfaMethods:s.mfaMethods,appMfaMethods:m.mfa.methods,userHasAuthSms:z,backFn:w,handleSelectMethod:async function(t){o(void 0);try{await A()}catch(r){return void o(r)}return t==="totp"?(p(t),k(null),void D().then(({totpSecret:r,totpAuthUrl:u})=>{k({authUrl:u,secret:r})}).catch(()=>{k(null),d()})):t==="passkey"&&T.length===1?await P():void p(t)},isTotpLoading:h==="totp"&&!g,isPasskeyLoading:W,error:f,onClose:a,setRemovingMfaMethod:async function(t){o(void 0);try{await A()}catch(r){return void o(r)}i(t)}}):e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:a,backFn:w},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(G,{})}),e.jsx(C,{children:"Add more security"}),e.jsxs(R,{children:[m?.name," does not have any verification methods enabled."]}),e.jsx(S,{children:e.jsx(M,{onClick:a,children:"Close"})}),e.jsx(x,{})]})}};export{Ue as MfaAuthEnrollmentFlowScreen,Ue as default};
