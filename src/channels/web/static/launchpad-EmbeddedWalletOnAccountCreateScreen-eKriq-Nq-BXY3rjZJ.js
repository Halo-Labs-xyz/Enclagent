import{r as u,j as v}from"./launchpad.js";import{d4 as k,d5 as g,dy as V,d6 as F,di as L,eO as X,dX as D,dY as q,dR as G,eP as H,dJ as J,dS as z}from"./launchpad-App-D179iYht.js";import{n as Q}from"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import{C as Y}from"./launchpad-circle-x-DddvhjMS.js";import"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";async function b(l,a){let r=`${l}-auto-${a==="ethereum"?"eth":"sol"}`,d=new TextEncoder().encode(r);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",d))).map(s=>s.toString(16).padStart(2,"0")).join("")}const Z=({errorMessage:l,onClose:a})=>v.jsx(Q,l?{title:"Something went wrong",subtitle:l,icon:Y,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}:{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),se={component:()=>{let{setModalData:l,navigate:a,data:r,onUserCloseViaDialogOrKeybindRef:d}=k(),s=g(),[O,W]=u.useState(""),{embeddedWallets:x}=g(),{authenticated:m,user:e}=V(),{closePrivyModal:c,walletProxy:A,client:E}=F(),{onSuccess:U,onFailure:w,callAuthOnSuccessOnClose:y,shouldCreateEth:R,shouldCreateSol:I}=r.createWallet,P=L(),h=e?P(X)?.shouldCreateWallet({user:e}):void 0,$=!!e&&D(e,s.embeddedWallets.ethereum.createOnLogin,h),T=!!e&&q(e,s.embeddedWallets.solana.createOnLogin,h),C=s.embeddedWallets.mode==="legacy-embedded-wallets-only"&&s?.embeddedWallets.requireUserOwnedRecoveryOnCreate===!0,[p,j]=u.useState(null),{create:o}=G(),n=R??$,i=I??T,K=new J(async()=>{let M=await E.getAccessToken();if(e&&M&&A)try{let t,f=await b(e.id,"ethereum"),S=await b(e.id,"solana");if(n&&i)t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:f}),t=await o({chainType:"solana",walletIndex:0,latestUser:t.user,idempotencyKey:S});else if(i)t=await o({chainType:"solana",walletIndex:0,latestUser:e,idempotencyKey:S});else{if(!n)return void c({shouldCallAuthOnSuccess:y});t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:f})}j(t),a("EmbeddedWalletCreatedScreen")}catch(t){W(t.message)}});return u.useEffect(()=>m&&e?C?(l({...r,createWallet:{...r.createWallet,shouldCreateEth:n,shouldCreateSol:i},recoverySelection:{...r?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:n,shouldCreateSol:i}}),a(H({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:x.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void K.execute():(a("LandingScreen"),void w(Error("User must be authenticated before creating a Privy wallet"))),[C,m]),d.current=()=>null,v.jsx(Z,{errorMessage:O||void 0,onClose:()=>{p?(U(p),c({shouldCallAuthOnSuccess:y})):(w(new z("User wallet creation failed")),c({shouldCallAuthOnSuccess:!1}))}})}};export{se as EmbeddedWalletOnAccountCreateScreen,Z as EmbeddedWalletOnAccountCreateView,se as default};
