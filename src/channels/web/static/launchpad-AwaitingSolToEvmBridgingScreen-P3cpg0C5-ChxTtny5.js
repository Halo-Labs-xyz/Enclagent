import{r,j as e}from"./launchpad.js";import{F as G}from"./launchpad-CheckCircleIcon-D2sCnQx5.js";import{c as J,n as K,s as X}from"./launchpad-Layouts-BlFm53ED-HTJjrY9f.js";import{u as U}from"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import{o as Z}from"./launchpad-ScreenHeader-CHmc4-Lu-Bz0hvEfr.js";import{t as b}from"./launchpad-FundWalletMethodHeader-DRH4o4R5-FwbuUnGj.js";import{t as ee}from"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import{d5 as j,d6 as ne,d4 as te,di as ae,dd as s,dj as re,dk as R,db as se,dl as D,dm as I,d9 as m,dg as oe}from"./launchpad-App-D179iYht.js";import{t as ie}from"./launchpad-analytics-mkkvFRju-DOXuftJB.js";import{u as de,o as le,f as ce,n as ue,s as me,r as fe}from"./launchpad-reservoir-0wfhnc0j-DglEJspj.js";import{I as pe}from"./launchpad-TransferOrBridgeLoadingScreen-BKmOAmlN-BSkZURGH.js";import{p as ge}from"./launchpad-parseEther-b5-X_2jr.js";import"./launchpad-InjectedWalletIcon-DLcYOGDj-DM-O-Fpn.js";import"./launchpad-WalletIcon-CmQNtWKM.js";import"./launchpad-Value-tcJV9e0L-rc9R0DBN.js";import"./launchpad-LoadingSkeleton-U6-3yFwI-De_7LaVb.js";import"./launchpad-Address-D-q_5it9-DVYLY2Ks.js";import"./launchpad-check-C5kCRahI.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";import"./launchpad-copy-DYa4Op8P.js";import"./launchpad-GlobeAltIcon-DfBLgGP6.js";const Be={component:function(){let W=j(),{closePrivyModal:k,createAnalyticsEvent:B,connectors:C}=ne(),{navigate:P,setModalData:_,data:o}=te(),x=j(),y=r.useRef(!1),E=ae(),[$,h]=r.useState(!1),[w,H]=r.useState(!1),[v,d]=r.useState(null),[L,M]=r.useState(),[q,F]=r.useState();if(!o?.funding||o.funding.chainType!=="ethereum")throw Error("Invalid funding data");let{amount:f,connectedWallet:p,chain:l,solanaChain:O,isUSDC:g}=o.funding,S=o.funding.address,Q=o.funding.erc20Address,A=o.funding.isUSDC?"USDC":l.nativeCurrency.symbol,t=r.useMemo(()=>p?.type==="solana"?p.provider:function({connectors:n,connectedWalletAddress:i}){let c=n.find(a=>a.chainType==="solana"&&a.wallets.some(T=>T.address===i)),u=c?.wallet.accounts.find(a=>a.address===i);if(!c||!u)throw new s("Unable to find source wallet connector");return new re({wallet:c.wallet,account:u})}({connectors:C,connectedWalletAddress:p?.address||""}),[p,C]),N=r.useMemo(()=>{let n=E(R);if(!n)throw new s("Unable to load solana plugin");let i=W.solanaRpcs["solana:mainnet"];if(!i)throw new s("Unable to load mainnet RPC");return n.getSolanaRpcClient({rpc:i.rpc,rpcSubscriptions:i.rpcSubscriptions,chain:"solana:mainnet",blockExplorerUrl:i.blockExplorerUrl??"https://explorer.solana.com"})},[]),V=se(D(t?.standardWallet.name||"unknown")),Y=V?.name||"wallet";return r.useEffect(()=>{(async function(){if(!t||!l||y.current)return;let n=E(R);if(!n)return void d(new s("Unable to solana plugin"));y.current=!0,l?.testnet&&console.warn("Solana testnets are not supported for bridging");let i=g?1e6*parseFloat(f):ge(f),c=await de({isTestnet:!!l.testnet,input:le({appId:x.id,amount:i.toString(),user:t.address,recipient:S,destinationChainId:l.id,originChainId:fe,originCurrency:g?ue:me,destinationCurrency:g?Q:void 0})}).catch(console.error);if(!c)return void d(new s(`Unable to fetch quotes for bridging. Wallet ${I(t.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE));let u=await n.createTransactionFromRelayQuote({quote:c,source:t.address,solanaClient:N});if(u)try{h(!0);let a=await n.simulateTransaction({solanaClient:N,tx:u});if(a.hasError)return a.hasFunds?(console.error("Transaction failed:",a.error),void d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))):void d(new s(`Wallet ${I(t?.address)} does not have enough funds. ${c.details.currencyIn.amountFormatted} ${A} are needed to complete the transaction.`,void 0,m.INSUFFICIENT_BALANCE));let{signature:T}=await t.signAndSendTransaction({chain:"solana:mainnet",transaction:u}),z=n.getAddressFromBuffer(T);M(z),F("pending")}catch(a){if(console.error(a),/user rejected the request/gi.test(a.message||""))return void d(new s("Transaction was rejected by the user",void 0,m.TRANSACTION_FAILURE));d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))}else d(new s(`Unable to select bridge option from quotes. Wallet ${I(t.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE))})().catch(console.error)},[]),ce({transactionHash:L,isTestnet:!1,bridgingStatus:q,setBridgingStatus:F,onSuccess({transactionHash:n}){h(!1),H(!0),B({eventName:ie,payload:{provider:"external",status:"success",txHash:n,address:t.address,chainType:"solana",clusterName:O,token:"SOL",destinationAddress:S,destinationChainId:l.id,destinationChainType:"ethereum",destinationValue:f,destinationToken:g?"USDC":"ETH"}})},onFailure({error:n}){h(!1),d(n)}}),r.useEffect(()=>{if(!w)return;let n=setTimeout(k,oe);return()=>clearTimeout(n)},[w]),r.useEffect(()=>{v&&(_({funding:o?.funding,solanaFundingData:o?.solanaFundingData,sendTransaction:o?.sendTransaction,errorModalData:{error:v,previousScreen:"TransferFromWalletScreen"}}),P("ErrorScreen",!1))},[v]),w?e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(G,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),e.jsx(Z,{title:"Success!",description:`Youâ€™ve successfully added ${f} ${A} to your ${x.name} wallet. It may take a minute before the funds are available to use.`})]}),e.jsx(X,{}),e.jsx(U,{})]}):$&&t?e.jsx(pe,{walletClientType:D(t?.standardWallet.name||"unknown"),displayName:Y,addressToFund:S,isBridging:$,isErc20Flow:!1,chainId:l.id,chainName:l.name,totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsx(ee,{}),e.jsx("div",{style:{marginTop:"1rem"}}),e.jsx(U,{})]})}};export{Be as AwaitingSolToEvmBridgingScreen,Be as default};
