import{r as n,j as e}from"./launchpad.js";import{T as d,g as u,F as Z,m as v,$ as oe}from"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import{F as D}from"./launchpad-ShieldCheckIcon-CP_2fGKU.js";import{dy as se,f2 as K,d4 as z,d5 as J,d6 as ae,eD as le,dr as ie,f3 as ce,eU as me,eV as de,f4 as ue}from"./launchpad-App-D179iYht.js";import{t as he,f as fe,l as xe,i as je}from"./launchpad-EnrollTotp-COmXYzq5-DDWyTrZe.js";import{F as pe}from"./launchpad-CheckCircleIcon-D2sCnQx5.js";import{F as Y}from"./launchpad-PhoneIcon-C1ddPHdQ.js";import{w as ye,p as we}from"./launchpad-ConnectPhoneForm-DTZTENXQ-bf-O6yMe.js";import{a as ve,d as N,w as x,l as j,p,m as g,s as ge,x as q,c as G,C as Ce,T as Fe}from"./launchpad-PinInput-3SLvbnQa-CovKtgDb.js";import{ErrorScreenView as ke}from"./launchpad-ErrorScreen-V8ec2dKP-DjcwwqNu.js";import"./launchpad-QrCode-VCBMkqqq-DYkl2ssX.js";import"./launchpad-FingerPrintIcon-CpCeQsPn.js";import"./launchpad-Chip-D2-wZOHJ-C13jw6H6.js";import"./launchpad-LoadingSkeleton-U6-3yFwI-De_7LaVb.js";import"./launchpad-LinkPasskeyScreen-BfLq2-Q5-CD3LfYpW.js";import"./launchpad-TodoList-CgrU7uwu-SiSPC2Wo.js";import"./launchpad-createLucideIcon-BSOjrqRH.js";import"./launchpad-check-C5kCRahI.js";import"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";import"./launchpad-circle-check-big-Bg8vqBbP.js";import"./launchpad-fingerprint-pattern-eZF4302v.js";import"./launchpad-CopyToClipboard-DSTf_eKU-kZApe455.js";import"./launchpad-Layouts-BlFm53ED-HTJjrY9f.js";import"./launchpad-LabelXs-oqZNqbm_-D2WTgiPX.js";import"./launchpad-Subtitle-CV-2yKE4-xZAXWUw0.js";import"./launchpad-Title-BnzYV3Is-Bc_Ic5pg.js";import"./launchpad-shared-FM0rljBt-BThDrsH1.js";import"./launchpad-reservoir-0wfhnc0j-DglEJspj.js";import"./launchpad-lock-DOKCRgid.js";import"./launchpad-dijkstra-D_NXgYpA.js";function Ee({title:r,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),r?n.createElement("title",{id:m},r):null,n.createElement("path",{fillRule:"evenodd",d:"M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const Se=n.forwardRef(Ee);function be({title:r,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),r?n.createElement("title",{id:m},r):null,n.createElement("path",{fillRule:"evenodd",d:"M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 7.47 7.47 0 0 1-3.522.877 7.47 7.47 0 0 1-3.522-.877.75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15ZM14.25 12a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H15a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15Z",clipRule:"evenodd"}))}const Me=n.forwardRef(be),Re=({appName:r,onComplete:m,onReset:h,onClose:a})=>{let[s,P]=n.useState(""),[W,T]=n.useState(!1),[E,C]=n.useState(null),[S,b]=n.useState("enroll"),{initEnrollmentWithSms:f,submitEnrollmentWithSms:A}=K(),{data:l}=z(),M=J();function F(){l?.mfaEnrollmentFlow?.onSuccess(),m()}return E?e.jsx(ke,{allowlistConfig:M.allowlistConfig,error:E,onBack:()=>C(null),onRetry:()=>C(null)}):e.jsxs(e.Fragment,S==="enroll"?{children:[e.jsx(d,{backFn:h,onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(j,{children:"Set up SMS verification"}),e.jsxs(p,{children:["We'll text a verification code to this mobile device whenever you use your ",r," ","wallet."]}),e.jsxs(N,{children:[e.jsx(ye,{onSubmit:async function({qualifiedPhoneNumber:y}){try{await f({phoneNumber:y}),P(y),b("verify")}catch(i){C(i)}},hideRecent:!0}),e.jsxs(Ce,{children:["By providing your mobile number, you agree to receive text messages from ",M?.name,". Some carrier charges may apply"]})]}),e.jsx(u,{})]}:W?{children:[e.jsx(d,{onClose:F},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(pe,{})}),e.jsx(j,{children:"SMS verification added"}),e.jsxs(p,{children:["From now on, you'll enter the verification code sent to your mobile device whenever you use your ",r," wallet."]}),e.jsx(g,{children:e.jsx(v,{onClick:F,children:"Done"})}),e.jsx(u,{})]}:{children:[e.jsx(d,{backFn:function(){S==="verify"?b("enroll"):h()},onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(j,{children:"Enter enrollment code"}),e.jsxs(N,{children:[e.jsx(Fe,{onChange:async function(y){try{if(!y)return;await A({phoneNumber:s,mfaCode:y}),T(!0)}catch(i){throw ce(i)?Error("You have exceeded the maximum number of attempts. Please close this window and try again in 10 seconds."):me(i)?Error("The code you entered is not valid"):de(i)?Error("You have exceeded the time limit for code entry. Please try again in 30 seconds."):ue(i)?Error("Verification canceled"):Error("Unknown error")}}}),e.jsxs(p,{children:["To continue, enter the 6-digit code sent to ",e.jsx("strong",{children:we(s)})]})]}),e.jsx(u,{})]})},cn={component:()=>{let{user:r,enrollInMfa:m,ready:h}=se(),[a,s]=n.useState(null),{unenrollWithSms:P,unenrollWithTotp:W,unenrollWithPasskey:T,submitEnrollmentWithTotp:E,initEnrollmentWithPasskey:C,submitEnrollmentWithPasskey:S,initEnrollmentWithTotp:b}=K(),{data:f,onUserCloseViaDialogOrKeybindRef:A}=z(),l=J(),{closePrivyModal:M}=ae(),{promptMfa:F}=le(),[y,i]=n.useState(!1),[R,$]=n.useState(null),[I,U]=n.useState(null),o=()=>{M({shouldCallAuthOnSuccess:!0}),m(!1),setTimeout(()=>{s(null),$(null)},500)},[Q,O]=n.useState(!1),[X,k]=n.useState();A.current=o;let _=r?.mfaMethods.includes("sms"),ee=!!r?.phone,ne=r?.mfaMethods.includes("totp"),te=r?.mfaMethods.includes("passkey"),B=_||ne||te,H=r?.linkedAccounts.filter(t=>t.type==="passkey").map(t=>t.credentialId)??[];function w(){s(null),$(null)}async function V(t=H){O(!0);try{return await C(),await S({credentialIds:t},{removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa}),f?.mfaEnrollmentFlow?.onSuccess(),o()}catch(c){k(c)}finally{O(!1)}}if(n.useEffect(()=>{B&&i(!0)},[B]),!h||!r||!l)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(ve,{children:e.jsx(he,{})}),e.jsx(N,{children:e.jsx(ie,{})}),e.jsx(u,{})]});if(a==="sms")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Z,{})}),e.jsx(j,{children:"Remove SMS verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await P()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Z,{})}),e.jsx(j,{children:"Remove authenticator app verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await W()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="passkey"){let t=f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Z,{})}),e.jsx(j,{children:"Are you sure you want to remove this passkey?"}),e.jsx(p,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await T({removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa})}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]})}if(f.mfaEnrollmentFlow.mfaMethods.length===0&&!B)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Add more security"}),e.jsxs(p,{children:[l?.name," does not have any verification methods enabled."]}),e.jsx(g,{children:e.jsx(v,{onClick:o,children:"Close"})}),e.jsx(u,{})]});let L=!B&&!y;return L?e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Transaction Protection"}),e.jsx(p,{children:"Set up transaction protection to add an extra layer of security to your account"}),e.jsxs(ge,{children:[e.jsxs(q,{children:[e.jsx(G,{children:e.jsx(Se,{})}),"Enable 2-Step verification for your ",l?.name," wallet."]}),e.jsxs(q,{children:[e.jsx(G,{children:e.jsx(Me,{})}),"You'll be prompted to authenticate to complete transactions."]})]}),e.jsxs(g,{children:[e.jsx(v,{onClick:()=>i(!0),children:"Continue"}),e.jsx(oe,{onClick:o,children:"Not now"})]}),e.jsx(u,{})]}):R==="sms"?e.jsx(Re,{appName:l?.name||"Privy",onComplete:o,onReset:w,onClose:o}):R==="totp"&&I?e.jsx(fe,{onClose:o,onReset:w,submitEnrollmentWithTotp:({mfaCode:t})=>async function(c){try{return k(void 0),await E({mfaCode:c}),f?.mfaEnrollmentFlow?.onSuccess(),o()}catch(re){k(re)}finally{s(null)}}(t),totpInfo:{...I,appName:l?.name||"Privy"}}):R==="passkey"?e.jsx(xe,{onReset:w,onClose:o,submitEnrollmentWithPasskey:V}):e.jsx(je,{showIntro:L,userMfaMethods:r.mfaMethods,appMfaMethods:l.mfa.methods,userHasAuthSms:ee,backFn:function(){i(!1)},handleSelectMethod:async function(t){try{await F()}catch(c){return void k(c)}return t==="totp"?($(t),U(null),void b().then(c=>{U(c)}).catch(()=>{U(null),w()})):t==="passkey"&&H.length===1?await V():void $(t)},isTotpLoading:R==="totp"&&!I,isPasskeyLoading:Q,error:X,onClose:o,setRemovingMfaMethod:async t=>{try{await F()}catch(c){return void k(c)}s(t)}})}};export{cn as MfaEnrollmentFlowScreen,cn as default};
