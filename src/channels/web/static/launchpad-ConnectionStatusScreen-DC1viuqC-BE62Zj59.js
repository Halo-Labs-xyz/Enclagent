import{r as a,j as m}from"./launchpad.js";import{dx as C,dy as j,d4 as we,d5 as me,d6 as he,di as ye,dn as Ce,db as Ee,dw as y,dz as _e,dA as V,dB as be,du as G,dC as B,dv as Te,dD as Re,d9 as E,dE as ve,dF as ke,dG as J,dH as Ae,ci as Le,b_ as We,dq as Ie}from"./launchpad-App-D179iYht.js";import{n as Q}from"./launchpad-Link-DJ5gq9Di-Bcmw2lMR.js";import{n as ee}from"./launchpad-useI18n-BdIAB9oU-W7UAn9Rw.js";import{a as Oe}from"./launchpad-shouldProceedtoEmbeddedWalletCreationFlow-BsPl2jCD-BqPojStS.js";import{n as Ue}from"./launchpad-ScreenLayout-Ca6ml9wY-CeAdm0Km.js";import"./launchpad-ModalHeader-JjfRejxC-gvXxgADS.js";import"./launchpad-Screen-DE3ldE_X-BBf8NvvX.js";import"./launchpad-index-Dq_xe9dz-bxbF5Mdc.js";const Z=i=>{let c=localStorage.getItem("-walletlink:https://www.walletlink.org:Addresses")?.split(" ").filter(s=>Le(s,{strict:!0})).map(s=>We(s));return!!c?.length&&!!i?.linkedAccounts.filter(s=>s.type=="wallet"&&c.includes(s.address)).length},xe=i=>i?.privyErrorCode===E.LINKED_TO_ANOTHER_USER?C.ERROR_USER_EXISTS:i instanceof ve&&!i.details.default?i.details:i instanceof ke?C.ERROR_TIMED_OUT:i?.privyErrorCode===E.CANNOT_LINK_MORE_OF_TYPE?C.ERROR_USER_LIMIT_REACHED:C.ERROR_WALLET_CONNECTION,Ne=({walletLogo:i,title:c,subtitle:s,signSuccess:g,errorMessage:d,connectSuccess:u,separateConnectAndSign:_,signing:R,walletConnectRedirectUri:v,walletConnectFallbackUniversalUri:r,hasTabbedAway:k,showCoinbaseWalletResetCta:A,numRetries:U,onBack:h,onSign:S,onRetry:L,onCoinbaseReset:b,onDifferentWallet:f})=>{let{t:e}=ee(),x=A?{label:"Use a different wallet",onClick:b,disabled:g}:d===C.ERROR_USER_EXISTS&&h?{label:"Use a different wallet",onClick:f}:u&&!g&&_?{label:R?"Signing":"Sign with your wallet",onClick:S,disabled:R}:!g&&d?.retryable&&U<2?{label:"Retry",onClick:L,disabled:!1}:g||d?void 0:{label:e("connectionStatus.connecting"),onClick:()=>{},disabled:!0};return m.jsx(Ue,{title:c,subtitle:s,icon:i,iconVariant:"loading",iconLoadingStatus:{success:g,fail:!!d},primaryCta:x,onBack:h,watermark:!0,children:!u&&v&&!k&&m.jsxs(Me,{children:[e("connectionStatus.stillHere")," ",m.jsx(Q,{href:v,target:"_blank",variant:"underlined",size:"sm",children:e("connectionStatus.tryConnectingAgain")}),r&&m.jsxs(m.Fragment,{children:[" ",e("connectionStatus.or")," ",m.jsx(Q,{href:r,target:"_blank",variant:"underlined",size:"sm",children:e("connectionStatus.useDifferentLink")})]})]})})},Ye={component:()=>{let i,[c,s]=a.useState(!1),[g,d]=a.useState(!1),[u,_]=a.useState(void 0),{authenticated:R,logout:v}=j(),{navigate:r,navigateBack:k,lastScreen:A,currentScreen:U,setModalData:h,data:S}=we(),L=me(),{t:b}=ee(),{getAuthFlow:f,walletConnectionStatus:e,closePrivyModal:x,initLoginWithWallet:F,loginWithWallet:te,updateWallets:ne,createAnalyticsEvent:ae}=he(),{walletConnectors:oe}=j(),[W,ie]=a.useState(0),{user:w}=j(),re=ye(),[le]=a.useState(w?.linkedAccounts.length||0),[H,ce]=a.useState(""),[se,de]=a.useState(""),[ue,q]=a.useState(!1),{hasTabbedAway:ge}=function(){let[t,n]=a.useState(!1),o=a.useCallback(()=>{document.hidden&&n(!0)},[]);return a.useEffect(()=>(document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)),[o]),{hasTabbedAway:t,reset:()=>n(!1)}}(),{enabled:Se,token:X}=Ce(),N=Ee(e?.connector?.walletClientType||"unknown"),T=y&&e?.connector?.connectorType==="wallet_connect_v2"||y&&e?.connector?.connectorType==="coinbase_wallet"||y&&e?.connector?.connectorType==="base_account"||y&&e?.connector?.connectorType==="injected"&&e?.connector?.walletClientType==="phantom"||y&&e?.connector?.connectorType==="solana_adapter"&&e.connector.walletClientType==="mobile_wallet_adapter",p=e?.status==="connected",z=e?.status==="switching_to_supported_chain";a.useEffect(()=>{let t=f(),n=t instanceof J||t instanceof V?t:void 0;p&&e.connector?.chainType==="solana"&&e.connector?.walletClientType==="phantom"&&re(_e)&&S?.login?.isSigningInWithLedgerSolana===void 0?r("ConnectLedgerScreen",!1):(p&&!n&&(!Se||X||R?F(e.connectedWallet,X,S?.login?.disableSignup,S?.login?.isSigningInWithLedgerSolana?"transaction":"plain").then(()=>{q(!0)}):(h({captchaModalData:{callback:o=>F(e.connectedWallet,o,S?.login?.disableSignup,S?.login?.isSigningInWithLedgerSolana?"transaction":"plain").then(()=>{q(!0)}),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),r("CaptchaScreen",!1))),n instanceof V&&S?.login?.isSigningInWithLedgerSolana&&(n.messageType="transaction"),n&&T&&p&&!n.preparedMessage?n.buildMessage():n&&!T&&p&&(g||(async()=>{d(!0),_(void 0);try{e?.connector?.connectorType==="wallet_connect_v2"&&e?.connector?.walletClientType==="metamask"&&await be(2500),await M()}catch(o){console.warn("Auto-prompted signature failed",o)}finally{d(!1)}})()))},[W,p,ue]),a.useEffect(()=>{if(w&&c){let t=G-500;if(L?.legal.requireUsersAcceptTerms&&!w.hasAcceptedTerms){let o=setTimeout(()=>{r("AffirmativeConsentScreen")},t);return()=>clearTimeout(o)}if(Oe(w,L.embeddedWallets)){let o=setTimeout(()=>{h({createWallet:{onSuccess:()=>{},onFailure:O=>{console.error(O),ae({eventName:"embedded_wallet_creation_failure_logout",payload:{error:O,screen:"ConnectionStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")},t);return()=>clearTimeout(o)}ne();let n=setTimeout(()=>x({shouldCallAuthOnSuccess:!0,isSuccess:!0}),G);return()=>clearTimeout(n)}},[w,c]);let Y=t=>{if(t?.privyErrorCode!==E.ALLOWLIST_REJECTED){if(t?.privyErrorCode===E.USER_LIMIT_REACHED)return console.error(new Ae(t).toString()),void r("UserLimitReachedScreen");if(t?.privyErrorCode!==E.USER_DOES_NOT_EXIST)return t?.privyErrorCode===E.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce?(h({accountTransfer:{nonce:t.data?.data?.nonce,account:f()?.meta.address,displayName:t.data?.data?.account?.displayName,externalWalletMetadata:{walletClientType:f()?.meta.walletClientType,chainId:f()?.meta.chainId,connectorType:f()?.meta.connectorType},linkMethod:f()instanceof J?"siwe":"siws",embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress}}),void r("LinkConflictScreen")):void _(xe(t));r("AccountNotFoundScreen")}else r("AllowlistRejectionScreen")};async function M(){try{await te(),s(!0)}catch(t){Y(t)}finally{d(!1)}}a.useEffect(()=>{e?.connectError&&Y(e?.connectError)},[e]),((t,n)=>{let o=a.useRef(()=>{});a.useEffect(()=>{o.current=t}),a.useEffect(()=>{if(n!==null){let O=setInterval(()=>o.current(),n||0);return()=>clearInterval(O)}},[n])})(()=>{let t=I==="wallet_connect_v2"&&e?.connector instanceof B?e.connector.redirectUri:void 0;t&&ce(t);let n=I==="wallet_connect_v2"&&e?.connector instanceof B?e.connector.fallbackUniversalRedirectUri:void 0;n&&de(n)},e?.connector instanceof B&&!H?500:null);let I=e?.connector?.connectorType||"injected",D=e?.connector?.walletClientType||"unknown",$=N?.metadata?.shortName||N?.name||e?.connector?.walletBranding.name||"Browser Extension",pe=N?.image_url?.md||e?.connector?.walletBranding.icon||(t=>m.jsx(Te,{...t})),K=$==="Browser Extension"?$.toLowerCase():$;i=c?b("connectionStatus.successfullyConnected",{walletName:K}):u?b("connectionStatus.errorTitle",{errorMessage:u.message}):z?"Switching networks":p?g&&T?"Signing":"Sign to verify":`Waiting for ${K}`;let l=b("connectionStatus.checkOtherWindows");c?l=le===(w?.linkedAccounts.length||0)?"Wallet was already linked.":"You're good to go!":W>=2&&u?l="Unable to connect wallet":u?l=u.detail:z?l="Switch your wallet to the requested network.":p&&T?l="Sign the message in your wallet to verify it belongs to you.":D==="metamask"&&y?l="Click continue to open and connect MetaMask.":D==="metamask"?l="For the best experience, connect only one wallet at a time.":I==="wallet_connect"?l="Open your mobile wallet app to continue":I==="coinbase_wallet"?Re()||(l=Z(w)?"Continue with the Coinbase app. Not the right wallet? Reset your connection below.":"Confirm in the Coinbase app/popup to continue."):S?.login?.isSigningInWithLedgerSolana&&(l="Ledger requires a transaction to verify your identity. You'll sign a transaction that performs no onchain action.");let P=oe?.walletConnectors?.find(t=>t.walletClientType==="coinbase_wallet"),fe=D==="coinbase_wallet"&&(Z(w)||u===C.ERROR_USER_EXISTS);return m.jsx(Ne,{walletLogo:pe,title:i,subtitle:l,signSuccess:c,errorMessage:u,connectSuccess:p,separateConnectAndSign:T,signing:g,walletConnectRedirectUri:H,walletConnectFallbackUniversalUri:se,hasTabbedAway:ge,showCoinbaseWalletResetCta:fe,numRetries:W,onBack:A&&U!==A?k:void 0,onSign:()=>{d(!0),M()},onRetry:()=>{ie(W+1),_(void 0),p?(d(!0),M()):e?.connectRetry()},onCoinbaseReset:()=>{P&&P?.disconnect()},onDifferentWallet:k})}};let Me=Ie.p`
  text-align: center;
  color: var(--privy-color-foreground-2);
  font-size: 14px;
  line-height: 22px;
  margin: 16px 0;
`;export{Ye as ConnectionStatusScreen,Ne as ConnectionStatusView,Ye as default,xe as getErrorDetails};
